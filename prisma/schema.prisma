generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// DEFINICIJA TIPOVA
enum Role {
  USER
  ADMIN
}

enum TransactionType {
  INCOME
  EXPENSE
}

// 1. KORISNIK
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())

  // Relacije
  expenses     Expense[]
  incomes      Income[]
  categories   Category[]
  budgets      Budget[]
  savingsGoals SavingsGoal[]
}

// 2. KATEGORIJA
model Category {
  id      Int             @id @default(autoincrement())
  name    String
  type    TransactionType
  icon    String?
  
  userId  Int?
  user    User?           @relation(fields: [userId], references: [id])

  expenses Expense[]
  incomes  Income[]
  budgets  Budget[] // Povezano može se postaviti budžet po kategoriji

  @@unique([name, userId])
}

// 3. TROŠAK
model Expense {
  id          Int      @id @default(autoincrement())
  amount      Float
  description String?
  createdAt   DateTime @default(now())

  userId      Int
  user        User     @relation(fields: [userId], references: [id])

  categoryId  Int
  category    Category @relation(fields: [categoryId], references: [id])
}

// 4. PRIHOD
model Income {
  id          Int      @id @default(autoincrement())
  amount      Float
  description String?
  createdAt   DateTime @default(now())

  userId      Int
  user        User     @relation(fields: [userId], references: [id])

  categoryId  Int
  category    Category @relation(fields: [categoryId], references: [id])
}

// 5. BUDŽET 
model Budget {
  id         Int      @id @default(autoincrement())
  limit      Float    
  month      Int      
  year       Int      

  userId     Int
  user       User     @relation(fields: [userId], references: [id])

  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])
}

// 6. CILJEVI ŠTEDNJE (NOVO)
model SavingsGoal {
  id            Int      @id @default(autoincrement())
  name          String  
  targetAmount  Float    
  currentAmount Float    @default(0) 
  deadline      DateTime?

  userId        Int
  user          User     @relation(fields: [userId], references: [id])
}